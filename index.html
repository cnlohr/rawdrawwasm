 <!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Test</title>
		<style>
			body { background-color: #000080; }
			document : {overflow: hidden; width=100%; height=100%;}
		</style>
	</head>
	<body>
		<canvas width=500 height=500 id=canvas></canvas>
		<script>
var blob = atob('AGFzbQEAAAABOgtgAn9/AGAAAGABfwBgA39/fwBgBH9/f38AYAF8AXxgBH99fX0AYAABf2ABfwF/ \
YAN9fX0BfWAAAXwCowIOA2VudhZDTkZHQ2xlYXJGcmFtZUludGVybmFsAAIDZW52F0NORkdTd2Fw \
QnVmZmVyc0ludGVybmFsAAEDZW52DUNORkdUYWNrUGl4ZWwAAANlbnYPQ05GR1RhY2tTZWdtZW50 \
AAQDZW52EU9HR2V0QWJzb2x1dGVUaW1lAAoDZW52E0NORkdTZXR1cEZ1bGxzY3JlZW4AAANlbnYP \
Q05GR0hhbmRsZUlucHV0AAEDZW52CUNORkdDb2xvcgAIA2VudhFDTkZHR2V0RGltZW5zaW9ucwAA \
A2VudhFDTkZHVGFja1JlY3RhbmdsZQAEA2VudgxDTkZHVGFja1BvbHkAAANlbnYDY29zAAUDZW52 \
A3NpbgAFA2VudgZtZW1vcnkCAAIDCgkHCQYDAAMCAQIGEgN/AUHg6QQLfwFBAAt/AUEACwdmBQRt \
YWluAA0VYXN5bmNpZnlfc3RhcnRfdW53aW5kABMUYXN5bmNpZnlfc3RvcF91bndpbmQAFBVhc3lu \
Y2lmeV9zdGFydF9yZXdpbmQAFRRhc3luY2lmeV9zdG9wX3Jld2luZAAUCpslCa8eAw9/CH0GfCMB \
QQJGBEAjAiMCKAIAQYR/ajYCACMCKAIAIgEoAgAhACABKAIEIQIgASgCCCEDIAEqAgwhDyABKgIQ \
IRAgASgCFCEEIAEoAhghBSABKgIcIREgASgCKCEIIAEoAiwhByABKAIwIQogASgCNCEJIAEqAjgh \
EiABKwI8IRkgASoCRCETIAErAkghGiABKAJQIQsgASoCVCEUIAEoAlghDCABKwJcIRsgASgCZCEN \
IAEqAmghFSABKgJsIRYgASgCcCEOIAErAnQhHCABKwIgIRcLAn8jAUECRgRAIwIjAigCAEF8ajYC \
ACMCKAIAKAIAIQYLIwFFBEAjACIAQfAAayICJAALIAZFQQEjARsEQBAEQQAjAUEBRg0BGiEXCyAG \
QQFGQQEjARsEQBAEQQEjAUEBRg0BGiEXCyMBRQRAQaAXQQE6AAALIAZBAkZBASMBGwRAQYAIQQAQ \
BUECIwFBAUYNARoLIwFFBEADQCAFQShHIgAEQCAFsiETQQAhBANAIARBKEcEQCAEsiESQQAhB0MA \
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 \
gID8AzYCKCAEIAFDAAAAAJI4AgwgBCACQwAAAACSOAIcIAQgA0MAAAAAkjgCLCAAIAQgABAQIARB \
QGskAAuyAQIGfwF9IwBBQGohBgNAIARBEEYEQAJAQQAhAwNAIANBwABGDQEgAiADaiADIAZqKAIA \
NgIAIANBBGohAwwACwALBSAEQQJ0IgVBMHEgAGohB0EAIQMgBSAGaiIFQQA2AgAgBEEDcSEIQwAA \
AAAhCQNAIANBEEcEQCAJIAMgB2oqAgAgAyAIckECdCABaioCAJSSIQkgA0EEaiEDDAELCyAFIAk4 \
AgAgBEEBaiEEDAELCwuYAQIBfwF9IwBBIGsiAiQAIAJBgICA/AM2AhwgAiAAKAIANgIQIAIgACkC \
BDcCFCACQRBqQeDJACACEBIgAkHg2QAgAhASIAEgAioCACACKgIMIgOVQcTJACoCAJNBzMkAKgIA \
lDgCACABIAIqAgggA5U4AgggASACKgIEIAOVQcjJACoCAJNB0MkAKgIAlDgCBCACQSBqJAAL6AEB \
EH0gASoCPCEHIAEqAjghCCABKgIwIQkgASoCNCEKIAEqAgwhCyABKgIIIQwgASoCACENIAEqAgQh \
DiABKgIcIQ8gASoCGCEQIAEqAhAhESABKgIUIRIgAiAAKgIAIgMgASoCIJQgACoCBCIEIAEqAiSU \
kiAAKgIIIgUgASoCKJSSIAAqAgwiBiABKgIslJI4AgggAiADIBGUIAQgEpSSIAUgEJSSIAYgD5SS \
OAIEIAIgAyANlCAEIA6UkiAFIAyUkiAGIAuUkjgCACACIAMgCZQgBCAKlJIgBSAIlJIgBiAHlJI4 \
AgwLGQBBASQBIAAkAiMCKAIAIwIoAgRLBEAACwsVAEEAJAEjAigCACMCKAIESwRAAAsLGQBBAiQB \
IAAkAiMCKAIAIwIoAgRLBEAACwsLnQ8CAEGACAuND1Rlc3QgQmVuY2gAAAAAAAD//wAACAAQABgA \
HwApADIAMwD/////OQBCAP//SwBTAFwAYABkAGwAcgB7AIQAiQCTAJgAngCjAKkArACyALYA//+6 \
AL0AwQDJANEA2QDiAOQA6ADsAPQA+AD6APwA/QD/AAUBCgEQARYBGwEhAScBLAE1ATwBPgFBAUQB \
SAFLAVEBWQFgAWoBcAF3AX4BhAGMAZIBmAGdAaYBqQGuAbMBugHBAcoB0gHYAdwB4AHlAewB9AH7 \
AQACBAIGAgoCDQIPAhECGAIdAiICJwItAjQCPAJCAkUCSgJRAlMCXAJiAmcCbQJzAngCfgKCAogC \
jQKUApgCngKiAqgCrAKyArYC//////////////////////////////////////////////////// \
/////////////////////////////////7wCvwLHAs4C2wLkAugC8gL0AvgC/gIEAwcDCQMRAxMD \
GAMeAyMDKwMtAzQDOwM8Az8DQQNGA0wDVQNeA2oDcAN5A4IDjAOXA6ADqwO3A8ADyQPSA9wD5QPt \
A/UD/gMGBA8EFwQeBCUELgQ3BD4EQgRLBFEEVwReBGQEbQR0BH4EhwSQBJoEpQSuBLkExgTPBNcE \
3wToBPAE9AT4BP0EAQUKBRQFGwUiBSoFMwU6BT4FRQVNBVUFXgVmBW4FdQX//wAJICkDIxSLAAkg \
KQQkE4wBISMUAwkRmhEiIxQDApkBISMJAykDCRKcAysTHCMiEQKLmhoBISMDiQMhKiEZAxQjmgEQ \
IRIJEhwDqwIDGwIaExCpASsDKQIRIhOKACIEiCACJKgBECkQFAsUqwALDCArrAAoAAIqEBwgrAEh \
IwMJIBAUjAMjJASLARApEBQLFCsErAEYIRCcAxwjHBCcAiIZIpsCKgIZApsBAqoCIhECE6oRIgKZ \
AhMiihAbnBAJIJkQHCAsASkDqyEQASMUCxCcAAkjLAQDIaghEAESAxQrAqwQmRABA5wQISOcASsR \
GyELAqoCKhGbBJsCqpwDqQAgJAQImgEQHASsARAhIgSsACAkDBKqAAIqIKwgAAIiJIwgAiIkBIoA \
ICESnAAMACAsBCwCqgACIiAIIowZmxkTjCACrAEpA6sAIowBECESG5whAQQkIhITqwQBECEsAqoA \
BBQjEgoSIRCIIxQDARCpABAhIxQEiAAELAAoApoADAAoApohEAEDFCMimgAMICwCqgAoEBwErAAg \
IxSLAAwCEiEoEiOsAASsBAARIKwEACogrAEQISMUA4kADAAQIRKKARAhIxQDCQSbAAwAECESAqwh \
EAEjFIsAKBCcAAQkqAADFCOoAAQsFBskqAABIywEAyGoAAESHBIhqAAgAgSsEAAEnAGrECAknAEQ \
qQSsAJkCBCQqIxKKAAQkIookBAMSqiAkBAKqJAQCIiObBAkCGgEQqSMSAxQjJBWMAAwDEiOsGRKc \
KiMkFYwADAMTKhOsEJwCDAIbEhwSI6wCDAMSI6wCIiQEigINBCQiigIELCUiigIMAxKqIgIDIySM \
ERwCqgIEFCskqgIDFCOqAgMUGhMkqgIsBKoCAxwiI40CIgSsIBAULBKKEBkTnAAQFAwSqgEQEagD \
BCQjEosYEZwhEAECEyoQmxEABCQrApoBChEpIisDGwIRIhOKABEoERwCKgOrEBoTnSAAAhEqAhMi \
JIwIqCAQEakQKSAhEZgRAhshEqsBIaoSqhAgIRkSGBGqAKgBECESiQIqERsDqwEQIQOrARAhEgoS \
I4sRqAINBBQrIqwUEAEaECCsmhQVjSCpECAhEZgBEgsRIpsACQIoEhMrIqwACQIoEiITFKwAEBEJ \
EQIoEhMrIqwYERIDFKsEAhEiLAMrEKkEAhEiLAMrAZgEAhEiLAMrARCpBAIRIiwDKwEQEagEAhEi \
LAMrCKgEAhEiLAMrACARiAAMAioAGRAcECgUrCMUAwEQKRQVjQIqAgQsAxsAmQIqAgQsAxsRqAIq \
AgQsAxsBEKkCKgIELAMbCKgCKhIcBCwAmQIqEhwELBGoAioSHAQsARCpAioSHAQsKIgAECEjFAQI \
ApoEAiQqARARqAIiJAQKAJkCIiQEChGoAiIkBAoRKACZAiIkBAoBEBGoASEkBAkIqAErA6kBECEj \
FAMJA6kBBCQpEagBBCQpAJkCBCQqARCpAQQkKQioAQITHBMiKRGoAAwBESITiwANABAhGgIiJIwC \
BCQqIxIKAJkCBCQqIxIKEagCBCQqIxIKARCpAgQkKiMSCgEQEagCBCQqIxIKCakCBCQqIxIKARAh \
iQIbAgQsEhwSKhMrIqsDBCwDEioUFY0kBAIiIxsAmSQEAiIjGxGoJAQCIiMbARCpJAQCIiMbCakS \
HACZEhwRqBIcARCpEhwJqQAqESgCIiQEigIMAxIjLAEQEagCBCQiCgCZAgQkIgoRqAIEJCIKARCp \
AgQkIgoBEBGoAgQkIgoJqRkCKpsCBCQiCgSqAgQUKyQqAJkCBBQrJCoRqAIEFCskKgEQqQIEFCsk \
KgmpAgMcIiMNEagADAIRIhOKAgMcIiMNCakAQZAXCwLgJAAvCXByb2R1Y2VycwEMcHJvY2Vzc2Vk \
LWJ5AQVjbGFuZw8xMC4wLjAtNHVidW50dTE=');
var memory = new WebAssembly.Memory({initial:200});
var HEAP8 = new Int8Array(memory.buffer);
var HEAPU8 = new Uint8Array(memory.buffer);
var HEAP16 = new Int16Array(memory.buffer);
var HEAPU16 = new Uint16Array(memory.buffer);
var HEAP32 = new Uint32Array(memory.buffer);
var HEAPU32 = new Uint32Array(memory.buffer);
var HEAPF32 = new Float32Array(memory.buffer);
var HEAPF64 = new Float64Array(memory.buffer);

let toUtf8Decoder = new TextDecoder( "utf-8" );
function toUTF8(ptr) {
	var len = 0|0; ptr |= 0;
	for( var i = ptr; HEAPU8[i] != 0; i++) len++;
	return toUtf8Decoder.decode(HEAPU8.subarray(ptr, ptr+len));
}

function rdColorToCSS( color )
{
	return "rgb( " + (color & 0xff) + ", " + ((color>>8) & 0xff) + ", " + ((color>>16) & 0xff) + " )";
}


var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
var fullscreen = false;

let wasmExports;
const DATA_ADDR = 16; // Where the unwind/rewind data structure will live.
let sleeping = false;

let lining = false;

const imports = {
	env: {

		CNFGTackSegment: (x1, y1, x2, y2) => {
			if( !lining ) { ctx.beginPath(); lining = true; }
			ctx.moveTo(x1+0.5, y1+0.5);
			ctx.lineTo(x2+0.5, y2+0.5);
		},
		CNFGTackPixel : (x1, y1 ) => {
			ctx.fillRect(x1|0, y1|0,1,1);
		},
		CNFGTackRectangle : (x1, y1, x2, y2) => {
			if( lining ) { lining = false; ctx.stroke(); } //Commit any batched line segment.
			x1 |= 0; y1 |= 0; x2 |= 0; y2 |= 0;
			ctx.fillRect(x1, y1, x2-x1, y2-y1);
		},
		CNFGColor : (color) => {
			if( lining ) { lining = false; ctx.stroke(); } //Commit any batched line segment.
			var strcol = rdColorToCSS( color );
			ctx.strokeStyle = strcol;
			ctx.fillStyle = strcol;
		},
		CNFGSetup : (title,w,h ) => {
			document.title = toUTF8( title );
			canvas.width = w;
			canvas.height = h;
			ctx.imageSmoothingEnabled = false;
			fullscreen = false;
		},
		CNFGSetupFullscreen : (title,w,h ) => {
			document.title = toUTF8( title );
			canvas.width = w;
			canvas.height = h;
			ctx.imageSmoothingEnabled = false;
			canvas.style = "position:absolute; top:0; left:0;"
			fullscreen = true;
		},
		CNFGClearFrameInternal: ( color ) => {
			ctx.fillStyle = rdColorToCSS( color );
			ctx.rect(0, 0, canvas.width, canvas.height);
			ctx.fill();
		},
		CNFGTackPoly: (vertices, numverts) => {
			var i = 0 | 0;
			numverts |= 0;
			vertices |= 0;
			if( numverts < 1 ) return;
			ctx.beginPath();
			ctx.moveTo(HEAP16[vertices>>1], HEAP16[(vertices>>1)+1] );
			vertices += 4;
			for( i = 1; i < numverts; i++ )
			{
				ctx.lineTo(HEAP16[vertices>>1], HEAP16[(vertices>>1)+1] );
				vertices += 4;
			}
			ctx.closePath();
			ctx.fill();
		},
		CNFGGetDimensions: (pw, ph) => {
			HEAP16[pw>>1] = canvas.width;
			HEAP16[ph>>1] = canvas.height;
		},
		CNFGHandleInput: () => {
		},
		CNFGSwapBuffersInternal: () => {
			if (!sleeping) {

				if( lining ) { lining = false; ctx.stroke(); } //Commit any batched line segment.


				// We are called in order to start a sleep/unwind.
				// Fill in the data structure. The first value has the stack location,
				// which for simplicity we can start right after the data structure itself.
				HEAP32[DATA_ADDR >> 2] = DATA_ADDR + 8;
				// The end of the stack will not be reached here anyhow.
				HEAP32[DATA_ADDR + 4 >> 2] = 1024;
				wasmExports.asyncify_start_unwind(DATA_ADDR);
				sleeping = true;
				// Resume after the proper delay.
				requestAnimationFrame(function() {
					if( fullscreen )
					{
						canvas.width = window.innerWidth;
						canvas.height = window.innerHeight;
					}
					wasmExports.asyncify_start_rewind(DATA_ADDR);
					// The code is now ready to rewind; to start the process, enter the
					// first function that should be on the call stack.
					wasmExports.main();
				});
			} else {
				// We are called as part of a resume/rewind. Stop sleeping.
				wasmExports.asyncify_stop_rewind();
				sleeping = false;
			}
		},
		CNFGUpdateScreenWithBitmapInternal : (memptr, width, height ) => {
			if( width <= 0 || height <= 0 ) return;
			var data = new ImageData( new Uint8ClampedArray(memory.buffer,memptr,width*height*4), width, height);
			ctx.putImageData( data, 0, 0);
		},
		Add1 : (i) => { return i+1; },
		sin : Math.sin,
		cos : Math.cos,
		tan : Math.tan,
		sinf : Math.sin,
		cosf : Math.cos,
		tanf : Math.tan,
		OGGetAbsoluteTime : () =>
		{
			return new Date().getTime()/1000.;
		},
		OGUSleep: (us) => {
			if (!sleeping) {
				// We are called in order to start a sleep/unwind.
				//console.log('sleep...');
				// Fill in the data structure. The first value has the stack location,
				// which for simplicity we can start right after the data structure itself.
				HEAP32[DATA_ADDR >> 2] = DATA_ADDR + 8;
				// The end of the stack will not be reached here anyhow.
				HEAP32[DATA_ADDR + 4 >> 2] = 1024;
				wasmExports.asyncify_start_unwind(DATA_ADDR);
				sleeping = true;
				// Resume after the proper delay.
				setTimeout(function() {
					wasmExports.asyncify_start_rewind(DATA_ADDR);
					// The code is now ready to rewind; to start the process, enter the
					// first function that should be on the call stack.
					wasmExports.main();
				}, us/1000);
			} else {
				// We are called as part of a resume/rewind. Stop sleeping.
				wasmExports.asyncify_stop_rewind();
				sleeping = false;
			}
		},
		memory: memory,
		print: console.log,
		draw: () => {},
		printc: (str, len) => { console.log(utf8decoder.decode(HEAPU8.subarray(str, str+len))) },
	}
};


var array = new Uint8Array(new ArrayBuffer(blob.length));
var i = 0|0;
for(i = 0; i < blob.length; i++) {
	array[i] = blob.charCodeAt(i);
}

WebAssembly.instantiate(array, imports).then(
	function(wa) { 
		instance = wa.instance;
		wasmExports = instance.exports;
		instance.exports.main();
	 } );
		</script>
	</body>
</html>
